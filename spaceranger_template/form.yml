---
title: "${app}"
cluster: "general"
attributes:
  bc_account: "${app}"
  bc_queue: "general"
  cores: 32
  app_version:
    required: true
    widget: "select"
    label: "Version"
    help: |
      Select the version of this app you would like to use.
    options:
  gpu: 0
  memory_multiplier: 4096
  sr_command:
    required: true
    widget: "select"
    label: "Command"
    options:
      - [ "Count gene expression and protein expression reads from a single capture area", "count",
          # Aggr
          data-hide-sr-csv: true,
          data-hide-sr-normalize: true,
          # Hide segment-only fields
          data-hide-sr-tissue_image: true,
          # mkfastq
        ]
      - [ "Aggregate data from multiple spaceranger count runs", "aggr",
          # Count
          data-hide-sr-image: true,
          data-hide-sr-darkimage: true,
          data-hide-sr-colorizedimage: true,
          data-hide-sr-cytaimage: true,
          data-hide-sr-dapi_index: true,
          data-hide-sr-slide: true,
          data-hide-sr-area: true,
          data-hide-sr-override_id: true,
          data-hide-sr-reorient_images: true,
          data-hide-sr-slidefile: true,
          data-hide-sr-image_scale: true,
          data-hide-sr-loupe_alignment: true,
          data-hide-sr-transcriptome: true,
          data-hide-sr-probe_set: true,
          data-hide-sr-filter_probes: true,
          data-hide-sr-fastqs: true,
          data-hide-sr-project: true,
          data-hide-sr-sample: true,
          data-hide-sr-lanes: true,
          data-hide-sr-libraries: true,
          data-hide-sr-feature_ref: true,
          data-hide-sr-unknown_slide: true,
          data-hide-sr-create_bam: true,
          data-hide-sr-nosecondary: true,
          data-hide-sr-r1_length: true,
          data-hide-sr-r2_length: true,
          data-hide-sr-no_libraries: true,
          data-hide-sr-nucleus_segmentation: true,
          data-hide-sr-custom_segmentation_file: true,
          data-hide-sr-max_nucleus_diameter_px: true,
          data-hide-sr-nucleus_expansion_distance_micron: true,
          data-hide-sr-custom_bin_size: true,
          data-hide-sr-umi_registration: true,
          data-hide-sr-umi_to_image_offset: true,
          # Hide segment-only fields
          data-hide-sr-tissue_image: true,
          # mkfastq
          # Count and Segment common
          data-hide-sr-output_dir: true
        ]
      - [ "Segment nuclei from a microscope image", "segment",
          # Hide aggr-only fields
            data-hide-sr-csv: true,
            data-hide-sr-normalize: true,
          # Count
            data-hide-sr-image: true,
            data-hide-sr-darkimage: true,
            data-hide-sr-colorizedimage: true,
            data-hide-sr-cytaimage: true,
            data-hide-sr-dapi_index: true,
            data-hide-sr-slide: true,
            data-hide-sr-area: true,
            data-hide-sr-override_id: true,
            data-hide-sr-reorient_images: true,
            data-hide-sr-slidefile: true,
            data-hide-sr-image_scale: true,
            data-hide-sr-loupe_alignment: true,
            data-hide-sr-transcriptome: true,
            data-hide-sr-probe_set: true,
            data-hide-sr-filter_probes: true,
            data-hide-sr-fastqs: true,
            data-hide-sr-project: true,
            data-hide-sr-sample: true,
            data-hide-sr-lanes: true,
            data-hide-sr-libraries: true,
            data-hide-sr-feature_ref: true,
            data-hide-sr-unknown_slide: true,
            data-hide-sr-create_bam: true,
            data-hide-sr-nosecondary: true,
            data-hide-sr-r1_length: true,
            data-hide-sr-r2_length: true,
            data-hide-sr-no_libraries: true,
            data-hide-sr-nucleus_segmentation: true,
            data-hide-sr-custom_segmentation_file: true,
            data-hide-sr-nucleus_expansion_distance_micron: true,
            data-hide-sr-custom_bin_size: true,
            data-hide-sr-umi_registration: true,
            data-hide-sr-umi_to_image_offset: true
          # mkfastq
      ]
      - [ "Run Illumina demultiplexer on sample sheets that contain 10x-specific sample index sets, and generate 10x-specific quality metrics after the demultiplex.", "mkfastq",
          # Aggr
            data-hide-sr-csv: true,
            data-hide-sr-normalize: true,
          # Count
            data-hide-sr-image: true,
            data-hide-sr-darkimage: true,
            data-hide-sr-colorizedimage: true,
            data-hide-sr-cytaimage: true,
            data-hide-sr-dapi_index: true,
            data-hide-sr-slide: true,
            data-hide-sr-area: true,
            data-hide-sr-override_id: true,
            data-hide-sr-reorient_images: true,
            data-hide-sr-slidefile: true,
            data-hide-sr-image_scale: true,
            data-hide-sr-loupe_alignment: true,
            data-hide-sr-transcriptome: true,
            data-hide-sr-probe_set: true,
            data-hide-sr-filter_probes: true,
            data-hide-sr-fastqs: true,
            data-hide-sr-project: true,
            data-hide-sr-sample: true,
            data-hide-sr-lanes: true,
            data-hide-sr-libraries: true,
            data-hide-sr-feature_ref: true,
            data-hide-sr-unknown_slide: true,
            data-hide-sr-create_bam: true,
            data-hide-sr-nosecondary: true,
            data-hide-sr-r1_length: true,
            data-hide-sr-r2_length: true,
            data-hide-sr-no_libraries: true,
            data-hide-sr-nucleus_segmentation: true,
            data-hide-sr-custom_segmentation_file: true,
            data-hide-sr-max_nucleus_diameter_px: true,
            data-hide-sr-nucleus_expansion_distance_micron: true,
            data-hide-sr-custom_bin_size: true,
            data-hide-sr-umi_registration: true,
            data-hide-sr-umi_to_image_offset: true,
            # Hide segment-only fields
            data-hide-sr-tissue_image: true,
      ]
  sr_id:
    label: "--id"
    help: "A unique run id and output folder name ([a-zA-Z0-9_-]+)"
    widget: "text_field"
    value: ""
  sr_description:
    label: "--description"
    help: "Sample description to embed in output files"
    widget: "text_field"
    value: ""
  sr_image:
    label: "--image (H&E TIFF/JPG)"
    help: "Single H&E brightfield image (TIFF or JPG). Optional if --sr_cytaimage is specified."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_darkimage:
    label: "--darkimage"
    help: "Multi-channel fluorescence image (multi-layer TIFF or multiple TIFF/JPEG files). Optional if --sr_cytaimage is specified."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_colorizedimage:
    label: "--colorizedimage"
    help: "Color image representing pre-colored fluorescence (single-layer TIFF or JPEG). Optional if --sr_cytaimage is specified."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_cytaimage:
    label: "--cytaimage"
    help: "Brightfield image generated by the CytAssist instrument"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_dapi_index:
    label: "--dapi-index"
    help: "Index of DAPI channel (1-indexed) of fluorescence image"
    widget: "number_field"
    value: 1
  sr_slide:
    label: "--slide"
    help: "Visium slide serial number (e.g. V10J25-015). Use --sr_unknown_slide if unknown."
    widget: "text_field"
    value: ""
  sr_area:
    label: "--area"
    help: "Visium capture area identifier (e.g. A1). Must be used with --sr_slide unless --sr_unknown_slide is used."
    widget: "text_field"
    value: ""
  sr_override_id:
    label: "--override-id"
    help: "Override slide serial number and capture area provided in CytAssist metadata"
    widget: "check_box"
    value: false
  sr_transcriptome:
    label: "--transcriptome"
    help: "Path of folder containing 10x-compatible reference"
    widget: "path_selector"
    directory: "/opt/ood_apps/spaceranger/references/"
    show_files: false
  sr_probe_set:
    label: "--probe-set"
    help: "Path of probe set CSV. Do not set for Visium HD 3â€™ Spatial Gene Expression."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_filter_probes:
    label: "--filter-probes"
    help: "Whether to filter the probe set using the included column of the probe set CSV"
    widget: "check_box"
    checked_value: "true"
    unchecked_value: "false"
    value: "true"
  sr_fastqs:
    label: "--fastqs"
    help: "Path to input FASTQ data"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: false
  sr_project:
    label: "--project"
    help: "Name of the project folder within a mkfastq or bcl2fastq-generated folder from which to pick FASTQs"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: false
  sr_sample:
    label: "--sample"
    help: "Prefix of the filenames of FASTQs to select"
    widget: "text_field"
    value: ""
  sr_lanes:
    label: "--lanes"
    help: "Only use FASTQs from selected lanes (comma-separated)"
    widget: "text_field"
    value: ""
  sr_libraries:
    label: "--libraries"
    help: "CSV file declaring input library data sources"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_feature_ref:
    label: "--feature-ref"
    help: "Feature reference CSV file for antibody panels"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_unknown_slide:
    label: "--unknown-slide"
    help: "Use when slide serial number and area are unknown."
    widget: "select"
    options:
      - [ "", "" ]
      - [ "visium-1", "visium-1" ]
      - [ "visium-2", "visium-2" ]
      - [ "visium-2-large", "visium-2-large" ]
      - [ "visium-hd", "visium-hd" ]
  sr_reorient_images:
    label: "--reorient-images"
    help: "Rotate/mirror image to align fiducial pattern (default: true)"
    widget: "check_box"
    checked_value: "true"
    unchecked_value: "false"
    value: "true"
  sr_slidefile:
    label: "--slidefile"
    help: "Slide design file (GPR/VLF). Only required offline."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_image_scale:
    label: "--image-scale"
    help: "Microns per microscope image pixel (float)"
    widget: "text_field"
    value: ""
  sr_loupe_alignment:
    label: "--loupe-alignment"
    help: "Alignment file produced by Loupe Browser manual alignment"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_create_bam:
    label: "--create-bam"
    help: "Enable or disable BAM file generation (default: true)"
    widget: "check_box"
    checked_value: "true"
    unchecked_value: "false"
    value: "true"
  sr_nosecondary:
    label: "--nosecondary"
    help: "Disable secondary analysis (e.g., clustering)"
    widget: "check_box"
    value: false
  sr_r1_length:
    label: "--r1-length"
    help: "Hard trim input Read 1 to this length before analysis"
    widget: "number_field"
  sr_r2_length:
    label: "--r2-length"
    help: "Hard trim input Read 2 to this length before analysis"
    widget: "number_field"
  sr_no_libraries:
    label: "--no-libraries"
    help: "Proceed using a --sr_feature_ref but no protein expression libraries"
    widget: "check_box"
    value: false
  sr_nucleus_segmentation:
    label: "--nucleus-segmentation"
    help: "Whether to perform automated nucleus segmentation when an H&E image is provided (default: true)"
    widget: "check_box"
    checked_value: "true"
    unchecked_value: "false"
    value: "true"
  sr_custom_segmentation_file:
    label: "--custom-segmentation-file"
    help: "User-provided segmentation (TIF/TIFF/BTF/NPY/CSV/GEOJSON). If set, must provide --sr_nucleus_expansion_distance_micron."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_max_nucleus_diameter_px:
    label: "--max-nucleus-diameter-px"
    help: "Expected max nucleus diameter in pixels (default 256, max 1024)"
    widget: "number_field"
    value: 256
  sr_nucleus_expansion_distance_micron:
    label: "--nucleus-expansion-distance-micron"
    help: "Max distance (microns) to assign barcode to a nucleus (default: 8)"
    widget: "text_field"
    value: "8"
  sr_dry:
    label: "--dry"
    help: "Do not execute the pipeline. Generate pipeline invocation (.mro) and stop"
    widget: "check_box"
    value: false
  sr_output_dir:
    label: "--output-dir"
    help: "Output the results to this directory"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: false
  sr_nopreflight:
    label: "--nopreflight"
    help: "Skip preflight checks"
    widget: "check_box"
    value: false
  sr_custom_bin_size:
    label: "--custom-bin-size"
    help: "Bin Visium HD data to specified bin size in microns (even integer between 4 and 100)"
    widget: "number_field"
  sr_umi_registration:
    label: "--umi-registration"
    help: "Enable UMI-based registration algorithm when H&E and Visium HD slide ID provided"
    widget: "check_box"
    checked_value: "true"
    unchecked_value: "false"
    value: "true"
  sr_umi_to_image_offset:
    label: "--umi-to-image-offset"
    help: "Custom offset for UMI registration in microns: dx=<float>,dy=<float> (e.g. dx=1.5,dy=-2.0)"
    widget: "text_field"
    value: ""
  # Aggregate-specific fields
  sr_csv:
    label: "--csv"
    help: "Path of CSV file enumerating spaceranger count outputs"
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true
  sr_normalize:
    label: "--normalize"
    help: "Library depth normalization mode (mapped or none)"
    widget: "select"
    options:
      - [ "mapped", "mapped" ]
      - [ "none", "none" ]
    value: "mapped"
  # Segment-specific fields
  sr_tissue_image:
    label: "--tissue-image (TIF/TIFF/BTF/JPG/JPEG)"
    help: "The H&E tissue image to run nucleus segmentation on. Fluorescent images not supported."
    widget: "path_selector"
    directory: "/mnt/nfs"
    show_files: true

form:
  - app_version
  - cores
  - gpu
  - bc_account
  - bc_num_hours
  - bc_queue
  - bc_email_on_started
  - memory_multiplier
  - sr_command
  - sr_id
  - sr_description
# Count-specific fields
  - sr_image
  - sr_darkimage
  - sr_colorizedimage
  - sr_cytaimage
  - sr_dapi_index
  - sr_slide
  - sr_area
  - sr_override_id
  - sr_transcriptome
  - sr_probe_set
  - sr_filter_probes
  - sr_fastqs
  - sr_project
  - sr_sample
  - sr_lanes
  - sr_libraries
  - sr_feature_ref
  - sr_unknown_slide
  - sr_reorient_images
  - sr_slidefile
  - sr_image_scale
  - sr_loupe_alignment
  - sr_create_bam
  - sr_nosecondary
  - sr_r1_length
  - sr_r2_length
  - sr_no_libraries
  - sr_nucleus_segmentation
  - sr_custom_segmentation_file
  - sr_max_nucleus_diameter_px
  - sr_nucleus_expansion_distance_micron
  - sr_custom_bin_size
  - sr_umi_registration
  - sr_umi_to_image_offset
# Segment-specific fields
  - sr_tissue_image
# Aggregate-specific fields
  - sr_csv
  - sr_normalize
# Count and Segment common
  - sr_output_dir
# Common across the board
  - sr_dry
  - sr_nopreflight

form_header: 10x Genomics offers pre-built human and mouse references for download. You can access those at /opt/ood_apps/spaceranger/references/
